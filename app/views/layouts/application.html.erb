<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>

  <meta name="description" content=""/>

  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

  <title>CodeHR</title>
  <%#= stylesheet_link_tag "application", :media => "all" %>

  <%= javascript_include_tag "application" %>
  <%= csrf_meta_tags %>
  <%= include_gon %>
  <!--<script type="text/javascript" src="/assets/jquery.js"></script>-->
  <!--<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>-->
  <!-- basic styles -->
  <link href="/assets/bootstrap.min.css" rel="stylesheet"/>

  <link href="/assets/bootstrap-responsive.min.css" rel="stylesheet"/>

  <link rel="stylesheet" href="/assets/font-awesome.min.css"/>
  <!--[if IE 7]>
  <link rel="stylesheet" href="/assets/font-awesome-ie7.min.css"/>
  <![endif]-->



  <!-- page specific plugin styles -->
  <link rel="stylesheet" href="/assets/jquery-ui-1.10.2.custom.min.css" />
  <link rel="stylesheet" href="/assets/chosen.css" />
  <link rel="stylesheet" href="/assets/datepicker.css" />
  <link rel="stylesheet" href="/assets/bootstrap-timepicker.css" />
  <link rel="stylesheet" href="/assets/daterangepicker.css" />
  <link rel="stylesheet" href="/assets/colorpicker.css" />




  <!-- ace styles -->
  <link rel="stylesheet" href="/assets/ace.min.css"/>
  <link rel="stylesheet" href="/assets/ace-responsive.min.css"/>
  <link rel="stylesheet" href="/assets/ace-skins.min.css"/>
  <!--[if lt IE 9]>
  <link rel="stylesheet" href="/assets/ace-ie.min.css"/>
  <link rel="stylesheet" href="/assets/hris.css"/>
  <![endif]-->
</head>

<body>
<div class="navbar navbar-inverse">
<div class="navbar-inner">
<div class="container-fluid">


<a class="brand" href="/">
  <small><i class="icon-leaf"></i> CodeHR</small>
</a>
<ul class="nav ace-nav pull-right">
<li class="grey">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown">
    <i class="icon-tasks"></i>
    <span class="badge" id="remtask"><%= current_user.user_tasks.where(seen: false).count %></span>
  </a>
  <ul class="pull-right dropdown-navbar dropdown-menu dropdown-caret dropdown-closer">
    <li class="nav-header" id="remain_task">
      <i class="icon-ok"></i> <%= current_user.user_tasks.where(seen: false).count %> Tasks to complete
    </li>

    <% current_user.user_tasks.where(seen: false).limit(5).desc(:created_at).each do |nm| %>
        <li class="unduntask">
          <a href="/user_tasks/<%= nm._id %>">
            <div class="clearfix">
              <span class="pull-left"><%= nm.title %></span>
            </div>
          </a>
        </li>
    <% end %>

    <li>
      <a href="#">
         <%= link_to 'See tasks with details', user_tasks_path %>
        <!--<i class="icon-arrow-right"></i>-->
      </a>
    </li>
  </ul>
</li>


<li class="purple">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown">
    <i class="icon-bell-alt icon-animated-bell icon-only"></i>
    <span id="notcnt" class="badge badge-important"><%= current_user.notification_masters.where(read: false).count %></span>
  </a>
  <ul class="pull-right dropdown-navbar navbar-pink dropdown-menu dropdown-caret dropdown-closer">
    <li class="nav-header" id="nott">
      <i class="icon-warning-sign"></i> <%= current_user.notification_masters.where(read: false).count %> Unread Notifications
    </li>

    <% current_user.notification_masters.where(read: false).limit(5).desc(:created_at).each do |nm| %>
        <li class="unread_nott">
          <a href="/notification_masters/<%= nm.id %>">
            <div class="clearfix">
              <span class="pull-left"><i class="icon-comment btn btn-mini btn-pink"></i><%=nm.description.truncate(20) %></span>
            </div>
          </a>
        </li>
    <% end %>

    <li>
      <a href="#">
        <%= link_to 'See all notifications', notification_masters_path %>
      </a>
    </li>
  </ul>
</li>


<li class="light-blue user-profile">
  <a class="user-menu dropdown-toggle" href="#" data-toggle="dropdown">
    <img alt="Jason's Photo" src="/assets/user.jpg" class="nav-user-photo"/>
		<span id="user_info">
			<small>Welcome,</small>
	      <%# if current_user.employee_master.employee_name.blank? %>
	        <%= current_user.name %>
	      <%# else %>
	        <%#= current_user.employee_master.employee_name %>
	      <%# end %>
		</span>
    <i class="icon-caret-down"></i>
  </a>
  <ul id="user_menu" class="pull-right dropdown-menu dropdown-yellow dropdown-caret dropdown-closer">
    <li>
      <a href="/employee_masters/<%= current_user.employee_master.id rescue nil %>/edit">
        <i class="icon-cog"></i>
        Settings
      </a>
    </li>
    <li>
      <a href="/employee_details/<%= current_user.employee_master.id rescue nil %>/edit">
        <i class="icon-user"></i>
        Profile
      </a>
    </li>
    <li class="divider"></li>
    <li><a href="<%= destroy_user_session_path %>"><i class="icon-off"></i> Logout</a></li>
  </ul>
</li>


</ul>
<!--/.ace-nav-->

</div>
<!--/.container-fluid-->
</div>
<!--/.navbar-inner-->
</div>
<!--/.navbar-->
<div class="container-fluid" id="main-container">
  <a href="#" id="menu-toggler"><span></span></a><!-- menu toggler -->

  <div id="sidebar">

    <div id="sidebar-shortcuts">
      <div id="sidebar-shortcuts-large">
        <a href = "/reports" class="btn btn-small btn-success"><i class="icon-signal"></i></a>
        <a href="<%# left_panels_path %>" class="btn btn-small btn-info"><i class="icon-pencil"></i></a>
        <a href="<%# ability_matrices_path %>" class="btn btn-small btn-warning"><i class="icon-group"></i></a>
        <a href="/power_admin" class="btn btn-small btn-danger"><i class="icon-cogs"></i></a>
      </div>
      <div id="sidebar-shortcuts-mini">
        <span class="btn btn-success"></span>
        <span class="btn btn-info"></span>
        <span class="btn btn-warning"></span>
        <span class="btn btn-danger"></span>
      </div>
    </div>
    

    <div id="sidebar-collapse"><i class="icon-double-angle-left"></i></div>


  </div>
  <!--/#sidebar-->


  <div id="main-content" class="clearfix">

    <div id="breadcrumbs">
      <!--<ul class="breadcrumb">-->
      <!--<li><i class="icon-home"></i> <a href="#">Home</a><span class="divider"><i class="icon-angle-right"></i></span>-->
      <!--</li>-->
      <!--<li><a href="#">Other Pages</a> <span class="divider"><i class="icon-angle-right"></i></span></li>-->
      <!--<li class="active">Blank Page</li>-->
      <!--</ul>-->
      <!--.breadcrumb-->

      <!--<div id="nav-search">-->
      <!--<form class="form-search">-->
      <!--<span class="input-icon">-->
      <!--<input autocomplete="off" id="nav-search-input" type="text" class="input-small search-query" placeholder="Search ..."/>-->
      <!--<i id="nav-search-icon" class="icon-search"></i>-->
      <!--</span>-->
      <!--</form>-->
      <!--</div>-->
      <!--#nav-search-->
    </div>
    <!--#breadcrumbs-->


    <div id="page-content" class="clearfix">


      <!--<div class="row-fluid">-->
      <!-- PAGE CONTENT BEGINS HERE -->
      <%= yield %>
      <!-- PAGE CONTENT ENDS HERE -->
      <!--</div>-->
      <!--/row-->

    </div>
    <!--/#page-content-->



  </div>
  <!-- #main-content -->

</div>

<!--/.fluid-container#main-container-->


<a href="#" id="btn-scroll-up" class="btn btn-small btn-inverse">
  <i class="icon-double-angle-up icon-only"></i>
</a>


<!-- basic scripts -->
<script src="/assets/bootstrap-timepicker.min.js"></script>

<script src="/assets/HTMLAppender-script.js"></script>

<script type="text/javascript">

    $(function() {
        $(document).ajaxSend(function(e, xhr, options) {
            var token = $("meta[name='csrf-token']").attr("content");
            xhr.setRequestHeader("X-CSRF-Token", token);
        });

        $('.text_filter').css('width','65%');

        $('table th input:checkbox').on('click', function () {
            var that = this;
            $(this).closest('table').find('tr > td:first-child input:checkbox')
                    .each(function () {
                        this.checked = that.checked;
                        $(this).closest('tr').toggleClass('selected');
                    });

        });

        $('#id-disable-check').on('click', function() {
            var inp = $('#form-input-readonly').get(0);
            if(inp.hasAttribute('disabled')) {
                inp.setAttribute('readonly' , 'true');
                inp.removeAttribute('disabled');
                inp.value="This text field is readonly!";
            }
            else {
                inp.setAttribute('disabled' , 'disabled');
                inp.removeAttribute('readonly');
                inp.value="This text field is disabled!";
            }
        });


        $(".chzn-select").chosen();
        $(".chzn-select-deselect").chosen({allow_single_deselect:true});

        $('textarea[class*=limited]').each(function() {
            var limit = parseInt($(this).attr('data-maxlength')) || 100;
            $(this).inputlimiter({
                "limit": limit,
                remText: '%n character%s remaining...',
                limitText: 'max allowed : %n.'
            });
        });

        $( "#eq > span" ).css({width:'90%', float:'left', margin:'15px'}).each(function() {
            // read initial values from markup and remove that
            var value = parseInt( $( this ).text(), 10 );
            $( this ).empty().slider({
                value: value,
                range: "min",
                animate: true

            });
        });

        $('.date-picker').datepicker();
        $('.time-picker').timepicker();
    });

    function poll_notification() {
        //alert('Sunny');
        return $.get('/notifications.json', null, function(data, status, jqXHR) {
            var d, m, msgsSorted, _i, _len;
            $('.unread_nott').empty().remove();
            $('#nott').html('<i class="icon-warning-sign"></i>'+data.length+' Unread Notifications');
            $('#notcnt').html(data.length);
            for (_i = 0; _i < data.length; _i++) {
                m = data[_i];
                var $a = $('.purple_open').find('.navbar-pink');
                var link= "/notification_masters/"+ m._id;
                var b= '<li class="unread_nott"><a href="'+link+'"><div class="clearfix">'+
                        '<span class="pull-left">' +
                        '<i class="icon-comment btn btn-mini btn-pink"></i>' +
                        m.description +
                        '</span>'+
                        '</div></a></li>';
                $(b).insertAfter($('#nott'));
            }
            return setTimeout(poll_notification, 5000);
        });
        console.log('testing')
    };


    function poll_task() {
        return $.get('/tasks.json', null, function(data, status, jqXHR) {
            var d, m, msgsSorted, _i, _len;
            $('.unduntask').empty().remove();
            $('#remain_task').html('<i class="icon-ok"></i> '+data.length+' Tasks to complete');
            $('#remtask').html(data.length);
            for (_i = 0; _i < data.length; _i++) {
                m = data[_i];
                var $a = $('.purple_open').find('.navbar-pink');
                var link= "/notification_masters/"+ m._id;
                var b= '<li class="unduntask"><a href="'+link+'"><div class="clearfix">'+
                        '<span class="pull-left">' +
                        '<i class="icon-comment btn btn-mini btn-pink"></i>' +
                        m.description +
                        '</span>'+
                        '</div></a></li>';
                $(b).insertAfter($('#remain_task'));
            }
            return setTimeout(poll_task, 5000);
        });
        console.log('testing')
    };




</script>

</body>
</html>